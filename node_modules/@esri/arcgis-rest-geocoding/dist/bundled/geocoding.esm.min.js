/* @preserve
* @esri/arcgis-rest-geocoding - v4.0.2 - Apache-2.0
* Copyright (c) 2017-2024 Esri, Inc.
* Sat Jun 15 2024 00:37:55 GMT+0000 (Coordinated Universal Time)
*/
import{request as e,appendCustomParams as t,warn as r,cleanUrl as n}from"@esri/arcgis-rest-request";const o="https://geocode-api.arcgis.com/arcgis/rest/services/World/GeocodeServer/",s="https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/";function a(t){const r=t&&t.endpoint||o,n=Object.assign({httpMethod:"GET",maxUrlLength:2e3},t);return e(r,n)}
/* @preserve
* @terraformer/arcgis - v2.0.7 - MIT
* Copyright (c) 2012-2021 Environmental Systems Research Institute, Inc.
* Thu Jul 22 2021 13:58:30 GMT-0700 (Pacific Daylight Time)
*/var i=function(e,t,r,n){var o=(n[0]-r[0])*(e[1]-r[1])-(n[1]-r[1])*(e[0]-r[0]),s=(t[0]-e[0])*(e[1]-r[1])-(t[1]-e[1])*(e[0]-r[0]),a=(n[1]-r[1])*(t[0]-e[0])-(n[0]-r[0])*(t[1]-e[1]);if(0!==a){var i=o/a,c=s/a;if(i>=0&&i<=1&&c>=0&&c<=1)return!0}return!1},c=function(e,t){for(var r=0;r<e.length-1;r++)for(var n=0;n<t.length-1;n++)if(i(e[r],e[r+1],t[n],t[n+1]))return!0;return!1},u=function(e){for(var t,r=0,n=0,o=e.length,s=e[n];n<o-1;n++)r+=((t=e[n+1])[0]-s[0])*(t[1]+s[1]),s=t;return r>=0},p=function(e,t){var r=c(e,t),n=function(e,t){for(var r=!1,n=-1,o=e.length,s=o-1;++n<o;s=n)(e[n][1]<=t[1]&&t[1]<e[s][1]||e[s][1]<=t[1]&&t[1]<e[n][1])&&t[0]<(e[s][0]-e[n][0])*(t[1]-e[n][1])/(e[s][1]-e[n][1])+e[n][0]&&(r=!r);return r}(e,t[0]);return!(r||!n)},l=function e(t,r){var n={};if(t.features){n.type="FeatureCollection",n.features=[];for(var o=0;o<t.features.length;o++)n.features.push(e(t.features[o],r))}if("number"==typeof t.x&&"number"==typeof t.y&&(n.type="Point",n.coordinates=[t.x,t.y],"number"==typeof t.z&&n.coordinates.push(t.z)),t.points&&(n.type="MultiPoint",n.coordinates=t.points.slice(0)),t.paths&&(1===t.paths.length?(n.type="LineString",n.coordinates=t.paths[0].slice(0)):(n.type="MultiLineString",n.coordinates=t.paths.slice(0))),t.rings&&(n=function(e){for(var t,r,n,o,s=[],a=[],i=0;i<e.length;i++){var l=(function(e,t){for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}((o=e[i].slice(0))[0],o[o.length-1])||o.push(o[0]),o);if(!(l.length<4))if(u(l)){var f=[l.slice().reverse()];s.push(f)}else a.push(l.slice().reverse())}for(var d=[];a.length;){n=a.pop();var g=!1;for(t=s.length-1;t>=0;t--)if(r=s[t][0],p(r,n)){s[t].push(n),g=!0;break}g||d.push(n)}for(;d.length;){n=d.pop();var m=!1;for(t=s.length-1;t>=0;t--)if(r=s[t][0],c(r,n)){s[t].push(n),m=!0;break}m||s.push([n.reverse()])}return 1===s.length?{type:"Polygon",coordinates:s[0]}:{type:"MultiPolygon",coordinates:s}}(t.rings.slice(0))),"number"==typeof t.xmin&&"number"==typeof t.ymin&&"number"==typeof t.xmax&&"number"==typeof t.ymax&&(n.type="Polygon",n.coordinates=[[[t.xmax,t.ymax],[t.xmin,t.ymax],[t.xmin,t.ymin],[t.xmax,t.ymin],[t.xmax,t.ymax]]]),(t.geometry||t.attributes)&&(n.type="Feature",n.geometry=t.geometry?e(t.geometry):null,n.properties=t.attributes?function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}(t.attributes):null,t.attributes))try{n.id=function(e,t){for(var r=t?[t,"OBJECTID","FID"]:["OBJECTID","FID"],n=0;n<r.length;n++){var o=r[n];if(o in e&&("string"==typeof e[o]||"number"==typeof e[o]))return e[o]}throw Error("No valid id attribute found")}(t.attributes,r)}catch(e){}return JSON.stringify(n.geometry)===JSON.stringify({})&&(n.geometry=null),t.spatialReference&&t.spatialReference.wkid&&4326!==t.spatialReference.wkid&&console.warn("Object converted in non-standard crs - "+JSON.stringify(t.spatialReference)),n};function f(s){let a,i={};return"string"==typeof s?(i.params={singleLine:s},a=o):(a=s.endpoint||o,i=t(s,["singleLine","address","address2","address3","neighborhood","city","subregion","region","postal","postalExt","countryCode","outFields","magicKey"],{params:Object.assign({},s.params)}),i.params.postal&&"number"==typeof i.params.postal&&r("The postal code should be a string. Issues can arise when using it as a number, especially if they start with zero.")),e(`${n(a)}/findAddressCandidates`,i).then((e=>{if("string"!=typeof s&&s.rawResponse)return e;const t=e.spatialReference;if(e.candidates.forEach((function(e){e.location.spatialReference=t,e.extent&&(e.extent.spatialReference=t)})),4326===t.wkid){const t=e.candidates.map((e=>({type:"Feature",geometry:l(e.location),properties:Object.assign({address:e.address,score:e.score},e.attributes)})));e.geoJson={type:"FeatureCollection",features:t}}return e}))}function d(t,r){const s=Object.assign({endpoint:o,params:{}},r);return s.params.text=t,e(`${n(s.endpoint)}/suggest`,s)}function g(t,r){const s=Object.assign({endpoint:o,params:{}},r);return!function(e){return 2===e.length||3===e.length}(t)?!function(e){return void 0!==e.latitude||void 0!==e.lat}(t)?s.params.location=t:(t.lat&&(s.params.location=t.long+","+t.lat),t.latitude&&(s.params.location=t.longitude+","+t.latitude)):s.params.location=t.join(),e(`${n(s.endpoint)}/reverseGeocode`,s)}function m(t){const r=Object.assign({endpoint:s,params:{}},t);return r.params.addresses={records:t.addresses.map((e=>({attributes:e})))},t.authentication||r.endpoint!==s?e(`${n(r.endpoint)}/geocodeAddresses`,r).then((e=>{if(r.rawResponse)return e;const t=e.spatialReference;return e.locations.forEach((function(e){e.location&&(e.location.spatialReference=t)})),e})):Promise.reject("bulk geocoding using the ArcGIS service requires authentication")}export{s as ARCGIS_ONLINE_BULK_GEOCODING_URL,o as ARCGIS_ONLINE_GEOCODING_URL,m as bulkGeocode,f as geocode,a as getGeocodeService,g as reverseGeocode,d as suggest};
//# sourceMappingURL=geocoding.esm.min.js.map
