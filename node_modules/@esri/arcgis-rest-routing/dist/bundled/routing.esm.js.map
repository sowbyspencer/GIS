{"version":3,"file":"routing.esm.js","sources":["../../src/helpers.ts","../../../../node_modules/@terraformer/arcgis/dist/t-arcgis.esm.js","../../src/solveRoute.ts","../../src/closestFacility.ts","../../src/serviceArea.ts","../../src/originDestinationMatrix.ts"],"sourcesContent":["/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport {\n  IRequestOptions,\n  ILocation,\n  IPoint,\n  IPolyline,\n  Position2D,\n  IFeatureSet\n} from \"@esri/arcgis-rest-request\";\n\n// https always\nexport const ARCGIS_ONLINE_ROUTING_URL =\n  \"https://route.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World\";\nexport const ARCGIS_ONLINE_CLOSEST_FACILITY_URL =\n  \"https://route.arcgis.com/arcgis/rest/services/World/ClosestFacility/NAServer/ClosestFacility_World\";\nexport const ARCGIS_ONLINE_SERVICE_AREA_URL =\n  \"https://route.arcgis.com/arcgis/rest/services/World/ServiceAreas/NAServer/ServiceArea_World\";\nexport const ARCGIS_ONLINE_ORIGIN_DESTINATION_MATRIX_URL =\n  \"https://route.arcgis.com/arcgis/rest/services/World/OriginDestinationCostMatrix/NAServer/OriginDestinationCostMatrix_World\";\n\n// nice to have: verify custom endpoints contain 'NAServer' and end in a '/'\nexport interface IEndpointOptions extends IRequestOptions {\n  /**\n   * Any ArcGIS Routing service (example: https://sampleserver3.arcgisonline.com/ArcGIS/rest/services/Network/USA/NAServer/Route/ ) to use for the routing service request.\n   */\n  endpoint?: string;\n}\n\nfunction isLocationArray(\n  coords: ILocation | IPoint | [number, number] | [number, number, number]\n): coords is [number, number] | [number, number, number] {\n  return (\n    (coords as [number, number]).length === 2 ||\n    (coords as [number, number, number]).length === 3\n  );\n}\n\nfunction isLocation(\n  coords: ILocation | IPoint | [number, number] | [number, number, number]\n): coords is ILocation {\n  return (\n    (coords as ILocation).latitude !== undefined ||\n    (coords as ILocation).lat !== undefined\n  );\n}\n\nexport function normalizeLocationsList(\n  locations: Array<IPoint | ILocation | [number, number]>\n): string[] {\n  return locations.map((coords) => {\n    if (isLocationArray(coords)) {\n      return coords.join();\n    } else if (isLocation(coords)) {\n      if (coords.lat) {\n        return coords.long + \",\" + coords.lat;\n      } else {\n        return coords.longitude + \",\" + coords.latitude;\n      }\n    } else {\n      return coords.x + \",\" + coords.y;\n    }\n  });\n}\n\nexport function decompressGeometry(str: string) {\n  let xDiffPrev = 0;\n  let yDiffPrev = 0;\n  const points = [];\n  let x;\n  let y;\n\n  // Split the string into an array on the + and - characters\n  const strings = str.match(/((\\+|-)[^+-]+)/g);\n\n  // The first value is the coefficient in base 32\n  const coefficient = parseInt(strings[0], 32);\n\n  for (let j = 1; j < strings.length; j += 2) {\n    // j is the offset for the x value\n    // Convert the value from base 32 and add the previous x value\n    x = parseInt(strings[j], 32) + xDiffPrev;\n    xDiffPrev = x;\n\n    // j+1 is the offset for the y value\n    // Convert the value from base 32 and add the previous y value\n    y = parseInt(strings[j + 1], 32) + yDiffPrev;\n    yDiffPrev = y;\n\n    points.push([x / coefficient, y / coefficient] as Position2D);\n  }\n\n  return {\n    paths: [points]\n  } as IPolyline;\n}\n\n/**\n * User Defined Type Guard that verifies this is a featureSet\n */\nexport function isFeatureSet(arg: any): arg is IFeatureSet {\n  return Object.prototype.hasOwnProperty.call(arg, \"features\");\n}\n\n/**\n * User Defined Type Guard that verifies this is a JSON with `url` property\n */\nexport function isJsonWithURL(arg: any): arg is Object {\n  return \"url\" in arg;\n}\n","/* @preserve\n* @terraformer/arcgis - v2.0.7 - MIT\n* Copyright (c) 2012-2021 Environmental Systems Research Institute, Inc.\n* Thu Jul 22 2021 13:58:30 GMT-0700 (Pacific Daylight Time)\n*/\n/* Copyright (c) 2012-2019 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nvar edgeIntersectsEdge = function edgeIntersectsEdge(a1, a2, b1, b2) {\n  var uaT = (b2[0] - b1[0]) * (a1[1] - b1[1]) - (b2[1] - b1[1]) * (a1[0] - b1[0]);\n  var ubT = (a2[0] - a1[0]) * (a1[1] - b1[1]) - (a2[1] - a1[1]) * (a1[0] - b1[0]);\n  var uB = (b2[1] - b1[1]) * (a2[0] - a1[0]) - (b2[0] - b1[0]) * (a2[1] - a1[1]);\n\n  if (uB !== 0) {\n    var ua = uaT / uB;\n    var ub = ubT / uB;\n\n    if (ua >= 0 && ua <= 1 && ub >= 0 && ub <= 1) {\n      return true;\n    }\n  }\n\n  return false;\n};\nvar coordinatesContainPoint = function coordinatesContainPoint(coordinates, point) {\n  var contains = false;\n\n  for (var i = -1, l = coordinates.length, j = l - 1; ++i < l; j = i) {\n    if ((coordinates[i][1] <= point[1] && point[1] < coordinates[j][1] || coordinates[j][1] <= point[1] && point[1] < coordinates[i][1]) && point[0] < (coordinates[j][0] - coordinates[i][0]) * (point[1] - coordinates[i][1]) / (coordinates[j][1] - coordinates[i][1]) + coordinates[i][0]) {\n      contains = !contains;\n    }\n  }\n\n  return contains;\n};\nvar pointsEqual = function pointsEqual(a, b) {\n  for (var i = 0; i < a.length; i++) {\n    if (a[i] !== b[i]) {\n      return false;\n    }\n  }\n\n  return true;\n};\nvar arrayIntersectsArray = function arrayIntersectsArray(a, b) {\n  for (var i = 0; i < a.length - 1; i++) {\n    for (var j = 0; j < b.length - 1; j++) {\n      if (edgeIntersectsEdge(a[i], a[i + 1], b[j], b[j + 1])) {\n        return true;\n      }\n    }\n  }\n\n  return false;\n};\n\n/* Copyright (c) 2012-2019 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nvar closeRing = function closeRing(coordinates) {\n  if (!pointsEqual(coordinates[0], coordinates[coordinates.length - 1])) {\n    coordinates.push(coordinates[0]);\n  }\n\n  return coordinates;\n}; // determine if polygon ring coordinates are clockwise. clockwise signifies outer ring, counter-clockwise an inner ring\n// or hole. this logic was found at http://stackoverflow.com/questions/1165647/how-to-determine-if-a-list-of-polygon-\n// points-are-in-clockwise-order\n\nvar ringIsClockwise = function ringIsClockwise(ringToTest) {\n  var total = 0;\n  var i = 0;\n  var rLength = ringToTest.length;\n  var pt1 = ringToTest[i];\n  var pt2;\n\n  for (i; i < rLength - 1; i++) {\n    pt2 = ringToTest[i + 1];\n    total += (pt2[0] - pt1[0]) * (pt2[1] + pt1[1]);\n    pt1 = pt2;\n  }\n\n  return total >= 0;\n}; // This function ensures that rings are oriented in the right directions\n// from http://jsperf.com/cloning-an-object/2\n\nvar shallowClone = function shallowClone(obj) {\n  var target = {};\n\n  for (var i in obj) {\n    // both arcgis attributes and geojson props are just hardcoded keys\n    if (obj.hasOwnProperty(i)) {\n      // eslint-disable-line no-prototype-builtins\n      target[i] = obj[i];\n    }\n  }\n\n  return target;\n};\n\n/* Copyright (c) 2012-2019 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nvar coordinatesContainCoordinates = function coordinatesContainCoordinates(outer, inner) {\n  var intersects = arrayIntersectsArray(outer, inner);\n  var contains = coordinatesContainPoint(outer, inner[0]);\n\n  if (!intersects && contains) {\n    return true;\n  }\n\n  return false;\n}; // do any polygons in this array contain any other polygons in this array?\n// used for checking for holes in arcgis rings\n\n\nvar convertRingsToGeoJSON = function convertRingsToGeoJSON(rings) {\n  var outerRings = [];\n  var holes = [];\n  var x; // iterator\n\n  var outerRing; // current outer ring being evaluated\n\n  var hole; // current hole being evaluated\n  // for each ring\n\n  for (var r = 0; r < rings.length; r++) {\n    var ring = closeRing(rings[r].slice(0));\n\n    if (ring.length < 4) {\n      continue;\n    } // is this ring an outer ring? is it clockwise?\n\n\n    if (ringIsClockwise(ring)) {\n      var polygon = [ring.slice().reverse()]; // wind outer rings counterclockwise for RFC 7946 compliance\n\n      outerRings.push(polygon); // push to outer rings\n    } else {\n      holes.push(ring.slice().reverse()); // wind inner rings clockwise for RFC 7946 compliance\n    }\n  }\n\n  var uncontainedHoles = []; // while there are holes left...\n\n  while (holes.length) {\n    // pop a hole off out stack\n    hole = holes.pop(); // loop over all outer rings and see if they contain our hole.\n\n    var contained = false;\n\n    for (x = outerRings.length - 1; x >= 0; x--) {\n      outerRing = outerRings[x][0];\n\n      if (coordinatesContainCoordinates(outerRing, hole)) {\n        // the hole is contained push it into our polygon\n        outerRings[x].push(hole);\n        contained = true;\n        break;\n      }\n    } // ring is not contained in any outer ring\n    // sometimes this happens https://github.com/Esri/esri-leaflet/issues/320\n\n\n    if (!contained) {\n      uncontainedHoles.push(hole);\n    }\n  } // if we couldn't match any holes using contains we can try intersects...\n\n\n  while (uncontainedHoles.length) {\n    // pop a hole off out stack\n    hole = uncontainedHoles.pop(); // loop over all outer rings and see if any intersect our hole.\n\n    var intersects = false;\n\n    for (x = outerRings.length - 1; x >= 0; x--) {\n      outerRing = outerRings[x][0];\n\n      if (arrayIntersectsArray(outerRing, hole)) {\n        // the hole is contained push it into our polygon\n        outerRings[x].push(hole);\n        intersects = true;\n        break;\n      }\n    }\n\n    if (!intersects) {\n      outerRings.push([hole.reverse()]);\n    }\n  }\n\n  if (outerRings.length === 1) {\n    return {\n      type: 'Polygon',\n      coordinates: outerRings[0]\n    };\n  } else {\n    return {\n      type: 'MultiPolygon',\n      coordinates: outerRings\n    };\n  }\n};\n\nvar getId = function getId(attributes, idAttribute) {\n  var keys = idAttribute ? [idAttribute, 'OBJECTID', 'FID'] : ['OBJECTID', 'FID'];\n\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n\n    if (key in attributes && (typeof attributes[key] === 'string' || typeof attributes[key] === 'number')) {\n      return attributes[key];\n    }\n  }\n\n  throw Error('No valid id attribute found');\n};\n\nvar arcgisToGeoJSON = function arcgisToGeoJSON(arcgis, idAttribute) {\n  var geojson = {};\n\n  if (arcgis.features) {\n    geojson.type = 'FeatureCollection';\n    geojson.features = [];\n\n    for (var i = 0; i < arcgis.features.length; i++) {\n      geojson.features.push(arcgisToGeoJSON(arcgis.features[i], idAttribute));\n    }\n  }\n\n  if (typeof arcgis.x === 'number' && typeof arcgis.y === 'number') {\n    geojson.type = 'Point';\n    geojson.coordinates = [arcgis.x, arcgis.y];\n\n    if (typeof arcgis.z === 'number') {\n      geojson.coordinates.push(arcgis.z);\n    }\n  }\n\n  if (arcgis.points) {\n    geojson.type = 'MultiPoint';\n    geojson.coordinates = arcgis.points.slice(0);\n  }\n\n  if (arcgis.paths) {\n    if (arcgis.paths.length === 1) {\n      geojson.type = 'LineString';\n      geojson.coordinates = arcgis.paths[0].slice(0);\n    } else {\n      geojson.type = 'MultiLineString';\n      geojson.coordinates = arcgis.paths.slice(0);\n    }\n  }\n\n  if (arcgis.rings) {\n    geojson = convertRingsToGeoJSON(arcgis.rings.slice(0));\n  }\n\n  if (typeof arcgis.xmin === 'number' && typeof arcgis.ymin === 'number' && typeof arcgis.xmax === 'number' && typeof arcgis.ymax === 'number') {\n    geojson.type = 'Polygon';\n    geojson.coordinates = [[[arcgis.xmax, arcgis.ymax], [arcgis.xmin, arcgis.ymax], [arcgis.xmin, arcgis.ymin], [arcgis.xmax, arcgis.ymin], [arcgis.xmax, arcgis.ymax]]];\n  }\n\n  if (arcgis.geometry || arcgis.attributes) {\n    geojson.type = 'Feature';\n    geojson.geometry = arcgis.geometry ? arcgisToGeoJSON(arcgis.geometry) : null;\n    geojson.properties = arcgis.attributes ? shallowClone(arcgis.attributes) : null;\n\n    if (arcgis.attributes) {\n      try {\n        geojson.id = getId(arcgis.attributes, idAttribute);\n      } catch (err) {// don't set an id\n      }\n    }\n  } // if no valid geometry was encountered\n\n\n  if (JSON.stringify(geojson.geometry) === JSON.stringify({})) {\n    geojson.geometry = null;\n  }\n\n  if (arcgis.spatialReference && arcgis.spatialReference.wkid && arcgis.spatialReference.wkid !== 4326) {\n    console.warn('Object converted in non-standard crs - ' + JSON.stringify(arcgis.spatialReference));\n  }\n\n  return geojson;\n};\n\n/* Copyright (c) 2012-2019 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n// outer rings are clockwise, holes are counterclockwise\n// used for converting GeoJSON Polygons to ArcGIS Polygons\n\nvar orientRings = function orientRings(poly) {\n  var output = [];\n  var polygon = poly.slice(0);\n  var outerRing = closeRing(polygon.shift().slice(0));\n\n  if (outerRing.length >= 4) {\n    if (!ringIsClockwise(outerRing)) {\n      outerRing.reverse();\n    }\n\n    output.push(outerRing);\n\n    for (var i = 0; i < polygon.length; i++) {\n      var hole = closeRing(polygon[i].slice(0));\n\n      if (hole.length >= 4) {\n        if (ringIsClockwise(hole)) {\n          hole.reverse();\n        }\n\n        output.push(hole);\n      }\n    }\n  }\n\n  return output;\n}; // This function flattens holes in multipolygons to one array of polygons\n// used for converting GeoJSON Polygons to ArcGIS Polygons\n\n\nvar flattenMultiPolygonRings = function flattenMultiPolygonRings(rings) {\n  var output = [];\n\n  for (var i = 0; i < rings.length; i++) {\n    var polygon = orientRings(rings[i]);\n\n    for (var x = polygon.length - 1; x >= 0; x--) {\n      var ring = polygon[x].slice(0);\n      output.push(ring);\n    }\n  }\n\n  return output;\n};\n\nvar geojsonToArcGIS = function geojsonToArcGIS(geojson, idAttribute) {\n  idAttribute = idAttribute || 'OBJECTID';\n  var spatialReference = {\n    wkid: 4326\n  };\n  var result = {};\n  var i;\n\n  switch (geojson.type) {\n    case 'Point':\n      result.x = geojson.coordinates[0];\n      result.y = geojson.coordinates[1];\n\n      if (geojson.coordinates[2]) {\n        result.z = geojson.coordinates[2];\n      }\n\n      result.spatialReference = spatialReference;\n      break;\n\n    case 'MultiPoint':\n      result.points = geojson.coordinates.slice(0);\n\n      if (geojson.coordinates[0][2]) {\n        result.hasZ = true;\n      }\n\n      result.spatialReference = spatialReference;\n      break;\n\n    case 'LineString':\n      result.paths = [geojson.coordinates.slice(0)];\n\n      if (geojson.coordinates[0][2]) {\n        result.hasZ = true;\n      }\n\n      result.spatialReference = spatialReference;\n      break;\n\n    case 'MultiLineString':\n      result.paths = geojson.coordinates.slice(0);\n\n      if (geojson.coordinates[0][0][2]) {\n        result.hasZ = true;\n      }\n\n      result.spatialReference = spatialReference;\n      break;\n\n    case 'Polygon':\n      result.rings = orientRings(geojson.coordinates.slice(0));\n\n      if (geojson.coordinates[0][0][2]) {\n        result.hasZ = true;\n      }\n\n      result.spatialReference = spatialReference;\n      break;\n\n    case 'MultiPolygon':\n      result.rings = flattenMultiPolygonRings(geojson.coordinates.slice(0));\n\n      if (geojson.coordinates[0][0][0][2]) {\n        result.hasZ = true;\n      }\n\n      result.spatialReference = spatialReference;\n      break;\n\n    case 'Feature':\n      if (geojson.geometry) {\n        result.geometry = geojsonToArcGIS(geojson.geometry, idAttribute);\n      }\n\n      result.attributes = geojson.properties ? shallowClone(geojson.properties) : {};\n\n      if (geojson.id) {\n        result.attributes[idAttribute] = geojson.id;\n      }\n\n      break;\n\n    case 'FeatureCollection':\n      result = [];\n\n      for (i = 0; i < geojson.features.length; i++) {\n        result.push(geojsonToArcGIS(geojson.features[i], idAttribute));\n      }\n\n      break;\n\n    case 'GeometryCollection':\n      result = [];\n\n      for (i = 0; i < geojson.geometries.length; i++) {\n        result.push(geojsonToArcGIS(geojson.geometries[i], idAttribute));\n      }\n\n      break;\n  }\n\n  return result;\n};\n\n/* Copyright (c) 2012-2019 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nexport { arcgisToGeoJSON, geojsonToArcGIS };\n","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport {\n  request,\n  cleanUrl,\n  ILocation,\n  IPoint,\n  IFeature,\n  IFeatureSet\n} from \"@esri/arcgis-rest-request\";\n\nimport {\n  ARCGIS_ONLINE_ROUTING_URL,\n  IEndpointOptions,\n  decompressGeometry,\n  isFeatureSet\n} from \"./helpers.js\";\n\nimport { arcgisToGeoJSON } from \"@terraformer/arcgis\";\n\ninterface IFeatureWithCompressedGeometry extends IFeature {\n  compressedGeometry?: string;\n}\n\ninterface IFeatureSetWithGeoJson extends IFeatureSet {\n  geoJson?: {};\n}\n\nexport interface ISolveRouteOptions extends IEndpointOptions {\n  /**\n   * Specify two or more locations between which the route is to be found.\n   */\n  stops:\n    | Array<IPoint | ILocation | [number, number] | [number, number, number]>\n    | IFeatureSet;\n}\n\nexport interface ISolveRouteResponse {\n  messages: string[];\n  checksum: string;\n  routes: IFeatureSetWithGeoJson;\n  directions?: Array<{\n    routeId: number;\n    routeName: string;\n    summary: object;\n    features: IFeature[];\n  }>;\n}\n\nfunction isLocationArray(\n  coords: ILocation | IPoint | [number, number] | [number, number, number]\n): coords is [number, number] | [number, number, number] {\n  return (\n    (coords as [number, number]).length === 2 ||\n    (coords as [number, number, number]).length === 3\n  );\n}\n\nfunction isLocation(\n  coords: ILocation | IPoint | [number, number] | [number, number, number]\n): coords is ILocation {\n  return (\n    (coords as ILocation).latitude !== undefined ||\n    (coords as ILocation).lat !== undefined\n  );\n}\n\n/**\n * Used to find the best way to get from one location to another or to visit several locations. See the [REST Documentation](https://developers.arcgis.com/rest/network/api-reference/route-synchronous-service.htm) for more information.\n *\n * ```js\n * import { solveRoute } from '@esri/arcgis-rest-routing';\n *\n * solveRoute({\n *   stops: [\n *     [-117.195677, 34.056383],\n *     [-117.918976, 33.812092],\n *    ],\n *    authentication\n * })\n *   .then(response) // => {routes: {features: [{attributes: { ... }, geometry:{ ... }}]}\n * ```\n *\n * @param requestOptions Options to pass through to the routing service.\n * @returns A Promise that will resolve with routes and directions for the request.\n * @restlink https://developers.arcgis.com/rest/network/api-reference/route-synchronous-service.htm\n */\nexport function solveRoute(\n  requestOptions: ISolveRouteOptions\n): Promise<ISolveRouteResponse> {\n  const options: ISolveRouteOptions = {\n    endpoint: requestOptions.endpoint || ARCGIS_ONLINE_ROUTING_URL,\n    params: {},\n    ...requestOptions\n  };\n\n  // the SAAS service does not support anonymous requests\n  if (\n    !requestOptions.authentication &&\n    options.endpoint === ARCGIS_ONLINE_ROUTING_URL\n  ) {\n    return Promise.reject(\n      \"Routing using the ArcGIS service requires authentication\"\n    );\n  }\n\n  if (isFeatureSet(requestOptions.stops)) {\n    options.params.stops = requestOptions.stops;\n  } else {\n    const stops: string[] = requestOptions.stops.map((coords) => {\n      if (isLocationArray(coords)) {\n        return coords.join();\n      } else if (isLocation(coords)) {\n        if (coords.lat) {\n          return (\n            coords.long + \",\" + coords.lat + (coords.z ? \",\" + coords.z : \"\")\n          );\n        } else {\n          return (\n            coords.longitude +\n            \",\" +\n            coords.latitude +\n            (coords.z ? \",\" + coords.z : \"\")\n          );\n        }\n      } else {\n        return coords.x + \",\" + coords.y + (coords.z ? \",\" + coords.z : \"\");\n      }\n    });\n\n    options.params.stops = stops.join(\";\");\n  }\n\n  return request(`${cleanUrl(options.endpoint)}/solve`, options).then(\n    cleanResponse\n  );\n}\n\nfunction cleanResponse(res: any): ISolveRouteResponse {\n  if (res.directions && res.directions.length > 0) {\n    res.directions = res.directions.map(\n      (direction: {\n        features: IFeatureWithCompressedGeometry[];\n        routeId: number;\n        routeName: string;\n        summary: {};\n      }) => {\n        direction.features = direction.features.map(\n          (feature: IFeatureWithCompressedGeometry) => {\n            feature.geometry = decompressGeometry(feature.compressedGeometry);\n            return feature;\n          }\n        );\n        return direction;\n      }\n    );\n  }\n\n  // add \"geoJson\" property to \"routes\"\n  if (res.routes.spatialReference.wkid === 4326) {\n    const features = res.routes.features.map((feature: any) => {\n      return {\n        type: \"Feature\",\n        geometry: arcgisToGeoJSON(feature.geometry),\n        properties: Object.assign({}, feature.attributes)\n      };\n    });\n\n    res.routes.geoJson = {\n      type: \"FeatureCollection\",\n      features\n    };\n  }\n  return res;\n}\n\nexport default {\n  solveRoute\n};\n","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport {\n  request,\n  cleanUrl,\n  appendCustomParams,\n  ILocation,\n  IPoint,\n  IFeature,\n  IFeatureSet\n} from \"@esri/arcgis-rest-request\";\n\nimport {\n  ARCGIS_ONLINE_CLOSEST_FACILITY_URL,\n  IEndpointOptions,\n  normalizeLocationsList,\n  isFeatureSet,\n  isJsonWithURL\n} from \"./helpers.js\";\n\nimport { arcgisToGeoJSON } from \"@terraformer/arcgis\";\n\nexport interface IClosestFacilityOptions extends IEndpointOptions {\n  /**\n   * Specify one or more locations from which the service searches for the nearby locations. These locations are referred to as incidents.\n   */\n  incidents:\n    | Array<IPoint | ILocation | [number, number]>\n    | IFeatureSet\n    | { url: string };\n\n  /**\n   * Specify one or more locations that are searched for when finding the closest location.\n   */\n  facilities:\n    | Array<IPoint | ILocation | [number, number]>\n    | IFeatureSet\n    | { url: string };\n  /**\n   *  Specify if the service should return routes.\n   */\n  returnCFRoutes: boolean;\n  travelDirection?: \"incidentsToFacilities\" | \"facilitiesToIncidents\";\n  barriers?: Array<IPoint | ILocation | [number, number]> | IFeatureSet;\n  polylineBarriers?: IFeatureSet;\n  polygonBarriers?: IFeatureSet;\n  returnDirections?: boolean;\n  directionsOutputType?:\n    | \"esriDOTComplete\"\n    | \"esriDOTCompleteNoEvents\"\n    | \"esriDOTInstructionsOnly\"\n    | \"esriDOTStandard\"\n    | \"esriDOTSummaryOnly\"\n    | \"esriDOTFeatureSets\";\n  directionsLengthUnits?:\n    | \"esriNAUCentimeters\"\n    | \"esriNAUDecimalDegrees\"\n    | \"esriNAUDecimeters\"\n    | \"esriNAUFeet\"\n    | \"esriNAUInches\"\n    | \"esriNAUKilometers\"\n    | \"esriNAUMeters\"\n    | \"esriNAUMiles\"\n    | \"esriNAUMillimeters\"\n    | \"esriNAUNauticalMiles\"\n    | \"esriNAUPoints\"\n    | \"esriNAUYards\";\n  outputLines?: boolean;\n  returnFacilities?: boolean;\n  returnIncidents?: boolean;\n  returnBarriers?: boolean;\n  returnPolylineBarriers?: boolean;\n  returnPolygonBarriers?: boolean;\n  preserveObjectID?: boolean;\n}\n\ninterface IFeatureSetWithGeoJson extends IFeatureSet {\n  geoJson?: any;\n}\n\nexport interface IClosestFacilityResponse {\n  messages: string[];\n  routes?: IFeatureSetWithGeoJson;\n  directions?: Array<{\n    routeId: number;\n    routeName: string;\n    summary: object;\n    features: IFeature[];\n  }>;\n  incidents?: IFeatureSet;\n  facilities?: IFeatureSet;\n  barriers?: IFeatureSet;\n  polygonBarriers?: IFeatureSet;\n  polylineBarriers?: IFeatureSet;\n}\n\nfunction getTravelDirection(\n  key: \"incidentsToFacilities\" | \"facilitiesToIncidents\"\n): \"esriNATravelDirectionFromFacility\" | \"esriNATravelDirectionToFacility\" {\n  if (key === \"incidentsToFacilities\") {\n    return \"esriNATravelDirectionFromFacility\";\n  } else {\n    return \"esriNATravelDirectionToFacility\";\n  }\n}\n\n/**\n * Used to find a route to the nearest of several possible destinations. See the [REST Documentation](https://developers.arcgis.com/rest/network/api-reference/closest-facility-synchronous-service.htm) for more information.\n *\n * ```js\n * import { closestFacility } from '@esri/arcgis-rest-routing';\n *\n * closestFacility({\n *   incidents: [\n *     [-90.404302, 38.600621],\n *     [-90.364293, 38.620427],\n *    ],\n *   facilities: [\n *     [-90.444716, 38.635501],\n *     [-90.311919, 38.633523],\n *     [-90.451147, 38.581107]\n *    ],\n *    authentication\n * })\n *   .then(response) // => {routes: {features: [{attributes: { ... }, geometry:{ ... }}]}\n * ```\n *\n * @param requestOptions Options to pass through to the routing service.\n * @returns A Promise that will resolve with routes and directions for the request.\n * @restlink https://developers.arcgis.com/rest/network/api-reference/closest-facility-synchronous-service.htm\n * @inline IClosestFacilityOptions\n */\nexport function closestFacility(\n  requestOptions: IClosestFacilityOptions\n): Promise<IClosestFacilityResponse> {\n  const endpoint =\n    requestOptions.endpoint || ARCGIS_ONLINE_CLOSEST_FACILITY_URL;\n\n  requestOptions.params = {\n    returnFacilities: true,\n    returnDirections: true,\n    returnIncidents: true,\n    returnBarriers: true,\n    returnPolylineBarriers: true,\n    returnPolygonBarriers: true,\n    preserveObjectID: true,\n    ...requestOptions.params\n  };\n\n  const options = appendCustomParams<IClosestFacilityOptions>(requestOptions, [\n    \"returnCFRoutes\",\n    // \"travelDirection\",\n    \"barriers\",\n    \"polylineBarriers\",\n    \"polygonBarriers\",\n    \"returnDirections\",\n    \"directionsOutputType\",\n    \"directionsLengthUnits\",\n    \"outputLines\",\n    \"returnFacilities\",\n    \"returnIncidents\",\n    \"returnBarriers\",\n    \"returnPolylineBarriers\",\n    \"returnPolygonBarriers\",\n    \"preserveObjectID\"\n  ]);\n\n  // Set travelDirection\n  if (requestOptions.travelDirection) {\n    options.params.travelDirection = getTravelDirection(\n      requestOptions.travelDirection\n    );\n  }\n\n  // the SAAS service does not support anonymous requests\n  if (\n    !requestOptions.authentication &&\n    endpoint === ARCGIS_ONLINE_CLOSEST_FACILITY_URL\n  ) {\n    return Promise.reject(\n      \"Finding the closest facility using the ArcGIS service requires authentication\"\n    );\n  }\n\n  if (\n    isFeatureSet(requestOptions.incidents) ||\n    isJsonWithURL(requestOptions.incidents)\n  ) {\n    options.params.incidents = requestOptions.incidents;\n  } else {\n    options.params.incidents = normalizeLocationsList(\n      requestOptions.incidents\n    ).join(\";\");\n  }\n\n  if (\n    isFeatureSet(requestOptions.facilities) ||\n    isJsonWithURL(requestOptions.facilities)\n  ) {\n    options.params.facilities = requestOptions.facilities;\n  } else {\n    options.params.facilities = normalizeLocationsList(\n      requestOptions.facilities\n    ).join(\";\");\n  }\n\n  // optional input param that may need point geometry normalizing\n  if (requestOptions.barriers) {\n    if (isFeatureSet(requestOptions.barriers)) {\n      options.params.barriers = requestOptions.barriers;\n    } else {\n      // optional point geometry barriers must be normalized, too\n      // but not if provided as IFeatureSet type\n      // note that optional polylineBarriers and polygonBarriers do not need to be normalized\n      options.params.barriers = normalizeLocationsList(\n        requestOptions.barriers\n      ).join(\";\");\n    }\n  }\n\n  return request(`${cleanUrl(endpoint)}/solveClosestFacility`, options).then(\n    cleanResponse\n  );\n}\n\nfunction cleanResponse(res: any): IClosestFacilityResponse {\n  // add \"geoJson\" property to \"routes\"\n  if (res.routes.spatialReference.wkid === 4326) {\n    res.routes.geoJson = arcgisToGeoJSON(res.routes);\n  }\n  return res;\n}\n\nexport default {\n  closestFacility\n};\n","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport {\n  request,\n  cleanUrl,\n  appendCustomParams,\n  ILocation,\n  IPoint,\n  IFeatureSet\n} from \"@esri/arcgis-rest-request\";\n\nimport {\n  ARCGIS_ONLINE_SERVICE_AREA_URL,\n  IEndpointOptions,\n  normalizeLocationsList,\n  isFeatureSet\n} from \"./helpers.js\";\n\nimport { arcgisToGeoJSON } from \"@terraformer/arcgis\";\n\nexport interface IServiceAreaOptions extends IEndpointOptions {\n  /**\n   *  Specify one or more locations around which service areas are generated.\n   */\n  facilities: Array<IPoint | ILocation | [number, number]> | IFeatureSet;\n  /**\n   *  Specify if the service should return routes.\n   */\n  travelDirection?: \"incidentsToFacilities\" | \"facilitiesToIncidents\";\n  barriers?: Array<IPoint | ILocation | [number, number]> | IFeatureSet;\n  polylineBarriers?: IFeatureSet;\n  polygonBarriers?: IFeatureSet;\n  outputLines?: boolean;\n  returnFacilities?: boolean;\n  returnBarriers?: boolean;\n  returnPolylineBarriers?: boolean;\n  returnPolygonBarriers?: boolean;\n  preserveObjectID?: boolean;\n}\n\ninterface IFeatureSetWithGeoJson extends IFeatureSet {\n  geoJson?: any;\n}\n\nexport interface IServiceAreaResponse {\n  messages: string[];\n  saPolygons?: IFeatureSetWithGeoJson;\n  incidents?: IFeatureSet;\n  facilities?: IFeatureSet;\n  barriers?: IFeatureSet;\n  polygonBarriers?: IFeatureSet;\n  polylineBarriers?: IFeatureSet;\n}\n\nfunction getTravelDirection(\n  key: \"incidentsToFacilities\" | \"facilitiesToIncidents\"\n): \"esriNATravelDirectionFromFacility\" | \"esriNATravelDirectionToFacility\" {\n  if (key === \"incidentsToFacilities\") {\n    return \"esriNATravelDirectionFromFacility\";\n  } else {\n    return \"esriNATravelDirectionToFacility\";\n  }\n}\n\n/**\n * Used to find the area that can be reached from the input location within a given travel time or travel distance. See the [REST Documentation](https://developers.arcgis.com/rest/network/api-reference/service-area-synchronous-service.htm) for more information.\n *\n * ```js\n * import { serviceArea } from '@esri/arcgis-rest-routing';\n *\n * serviceArea({\n *   facilities: [\n *     [-90.444716, 38.635501],\n *     [-90.311919, 38.633523],\n *     [-90.451147, 38.581107]\n *    ],\n *    authentication\n * })\n *   .then(response) // => {routes: {features: [{attributes: { ... }, geometry:{ ... }}]}\n * ```\n *\n * @param requestOptions Options to pass through to the routing service.\n * @returns A Promise that will resolve with service area polygons for the request.\n * @restlink https://developers.arcgis.com/rest/network/api-reference/service-area-synchronous-service.htm\n */\nexport function serviceArea(\n  requestOptions: IServiceAreaOptions\n): Promise<IServiceAreaResponse> {\n  const endpoint = requestOptions.endpoint || ARCGIS_ONLINE_SERVICE_AREA_URL;\n\n  requestOptions.params = {\n    returnFacilities: true,\n    returnBarriers: true,\n    returnPolylineBarriers: true,\n    returnPolygonBarriers: true,\n    preserveObjectID: true,\n    ...requestOptions.params\n  };\n\n  const options = appendCustomParams<IServiceAreaOptions>(requestOptions, [\n    \"barriers\",\n    \"polylineBarriers\",\n    \"polygonBarriers\",\n    \"outputLines\",\n    \"returnFacilities\",\n    \"returnBarriers\",\n    \"returnPolylineBarriers\",\n    \"returnPolygonBarriers\",\n    \"preserveObjectID\"\n  ]);\n\n  // Set travelDirection\n  if (requestOptions.travelDirection) {\n    options.params.travelDirection = getTravelDirection(\n      requestOptions.travelDirection\n    );\n  }\n\n  // the SAAS service does not support anonymous requests\n  if (\n    !requestOptions.authentication &&\n    endpoint === ARCGIS_ONLINE_SERVICE_AREA_URL\n  ) {\n    return Promise.reject(\n      \"Finding service areas using the ArcGIS service requires authentication\"\n    );\n  }\n\n  if (isFeatureSet(requestOptions.facilities)) {\n    options.params.facilities = requestOptions.facilities;\n  } else {\n    options.params.facilities = normalizeLocationsList(\n      requestOptions.facilities\n    ).join(\";\");\n  }\n\n  // optional input param that may need point geometry normalizing\n  if (requestOptions.barriers) {\n    if (isFeatureSet(requestOptions.barriers)) {\n      options.params.barriers = requestOptions.barriers;\n    } else {\n      // optional point geometry barriers must be normalized, too\n      // but not if provided as IFeatureSet type\n      // note that optional polylineBarriers and polygonBarriers do not need to be normalized\n      options.params.barriers = normalizeLocationsList(\n        requestOptions.barriers\n      ).join(\";\");\n    }\n  }\n\n  return request(`${cleanUrl(endpoint)}/solveServiceArea`, options).then(\n    cleanResponse\n  );\n}\n\nfunction cleanResponse(res: any): IServiceAreaResponse {\n  // remove \"fieldAliases\" because it does not do anything.\n  delete res.saPolygons.fieldAliases;\n\n  // add \"geoJson\" property to \"saPolygons\"\n  if (res.saPolygons.spatialReference.wkid === 4326) {\n    res.saPolygons.geoJson = arcgisToGeoJSON(res.saPolygons);\n  }\n  return res;\n}\n\nexport default {\n  serviceArea\n};\n","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport {\n  request,\n  cleanUrl,\n  appendCustomParams,\n  IRequestOptions,\n  ILocation,\n  IPoint,\n  IFeatureSet\n} from \"@esri/arcgis-rest-request\";\n\nimport {\n  ARCGIS_ONLINE_ORIGIN_DESTINATION_MATRIX_URL,\n  IEndpointOptions,\n  normalizeLocationsList,\n  isFeatureSet\n} from \"./helpers.js\";\n\nimport { arcgisToGeoJSON } from \"@terraformer/arcgis\";\n\nexport interface IOriginDestinationMatrixOptions extends IEndpointOptions {\n  /**\n   *  Specify the starting points from which to travel to the destinations.\n   */\n  origins: Array<IPoint | ILocation | [number, number]> | IFeatureSet;\n  /**\n   *  Specify the ending point locations to travel to from the origins.\n   */\n  destinations: Array<IPoint | ILocation | [number, number]> | IFeatureSet;\n  /**\n   *  Specify the type of output returned by the service. Defaults to \"esriNAODOutputSparseMatrix\".\n   */\n  outputType?:\n    | \"esriNAODOutputSparseMatrix\"\n    | \"esriNAODOutputStraightLines\"\n    | \"esriNAODOutputNoLines\";\n  barriers?: Array<IPoint | ILocation | [number, number]> | IFeatureSet;\n  polylineBarriers?: IFeatureSet;\n  polygonBarriers?: IFeatureSet;\n  returnOrigins?: boolean;\n  returnDestinations?: boolean;\n  returnBarriers?: boolean;\n  returnPolylineBarriers?: boolean;\n  returnPolygonBarriers?: boolean;\n}\n\ninterface IFeatureSetWithGeoJson extends IFeatureSet {\n  geoJson?: any;\n}\n\nexport interface IOriginDestinationMatrixResponse {\n  messages: [{ type: number; description: string }];\n  /**\n   *  Only present if outputType is \"esriNAODOutputSparseMatrix\". Full description is available at https://developers.arcgis.com/rest/network/api-reference/origin-destination-cost-matrix-synchronous-service.htm#ESRI_SECTION2_114F8364507C4B56B780DFAD505270FB.\n   */\n  odCostMatrix?: any;\n  /**\n   *  Only present if outputType is \"esriNAODOutputStraightLines\" or \"esriNAODOutputNoLines\". Includes the geometry for the straight line connecting each origin-destination pair when the outputType is \"esriNAODOutputStraightLines\".\n   */\n  odLines?: IFeatureSetWithGeoJson;\n  origins?: IFeatureSetWithGeoJson;\n  destinations?: IFeatureSetWithGeoJson;\n  barriers?: IFeatureSetWithGeoJson;\n  polylineBarriers?: IFeatureSetWithGeoJson;\n  polygonBarriers?: IFeatureSetWithGeoJson;\n}\n\n/**\n * Used to create an origin-destination (OD) cost matrix from multiple origins to multiple destinations. See the [REST Documentation](https://developers.arcgis.com/rest/network/api-reference/origin-destination-cost-matrix-synchronous-service.htm) for more information.\n *\n * ```js\n * import { originDestinationMatrix } from '@esri/arcgis-rest-routing';\n *\n * originDestinationMatrix({\n *   origins: [\n *     [-90.404302, 38.600621],\n *     [-90.364293, 38.620427],\n *   ],\n *   destinations: [\n *     [-90.444716, 38.635501],\n *     [-90.311919, 38.633523],\n *     [-90.451147, 38.581107]\n *   ],\n *   authentication\n * })\n *   .then(response) // => { ... }\n * ```\n *\n * @param requestOptions Options to pass through to the routing service.\n * @returns A Promise that will resolve with travel time and/or distance for each origin-destination pair. It returns either odLines or odCostMatrix for this information depending on the outputType you specify.\n * @restlink https://developers.arcgis.com/rest/network/api-reference/origin-destination-cost-matrix-synchronous-service.htm\n */\nexport function originDestinationMatrix(\n  requestOptions: IOriginDestinationMatrixOptions\n): Promise<IOriginDestinationMatrixResponse> {\n  const endpoint =\n    requestOptions.endpoint || ARCGIS_ONLINE_ORIGIN_DESTINATION_MATRIX_URL;\n\n  requestOptions.params = {\n    outputType: \"esriNAODOutputSparseMatrix\",\n    returnOrigins: true,\n    returnDestinations: true,\n    returnBarriers: true,\n    returnPolylineBarriers: true,\n    returnPolygonBarriers: true,\n    ...requestOptions.params\n  };\n\n  const options = appendCustomParams<IOriginDestinationMatrixOptions>(\n    requestOptions,\n    [\n      \"outputType\",\n      \"barriers\",\n      \"polylineBarriers\",\n      \"polygonBarriers\",\n      \"returnOrigins\",\n      \"returnDestinations\",\n      \"returnBarriers\",\n      \"returnPolylineBarriers\",\n      \"returnPolygonBarriers\"\n    ]\n  );\n\n  // the SAAS service does not support anonymous requests\n  if (\n    !requestOptions.authentication &&\n    endpoint === ARCGIS_ONLINE_ORIGIN_DESTINATION_MATRIX_URL\n  ) {\n    return Promise.reject(\n      \"Calculating the origin-destination cost matrix using the ArcGIS service requires authentication\"\n    );\n  }\n\n  // use a formatting helper for input params of this type: Array<IPoint | ILocation | [number, number]>\n  if (isFeatureSet(requestOptions.origins)) {\n    options.params.origins = requestOptions.origins;\n  } else {\n    options.params.origins = normalizeLocationsList(\n      requestOptions.origins\n    ).join(\";\");\n  }\n\n  if (isFeatureSet(requestOptions.destinations)) {\n    options.params.destinations = requestOptions.destinations;\n  } else {\n    options.params.destinations = normalizeLocationsList(\n      requestOptions.destinations\n    ).join(\";\");\n  }\n\n  // optional input param that may need point geometry normalizing\n  if (requestOptions.barriers) {\n    if (isFeatureSet(requestOptions.barriers)) {\n      options.params.barriers = requestOptions.barriers;\n    } else {\n      // optional point geometry barriers must be normalized, too\n      // but not if provided as IFeatureSet type\n      // note that optional polylineBarriers and polygonBarriers do not need to be normalized\n      options.params.barriers = normalizeLocationsList(\n        requestOptions.barriers\n      ).join(\";\");\n    }\n  }\n\n  return request(`${cleanUrl(endpoint)}/solveODCostMatrix`, options).then(\n    function (res) {\n      return cleanResponse(res, options);\n    }\n  );\n}\n\nfunction cleanResponse(\n  res: any,\n  options: IRequestOptions\n): IOriginDestinationMatrixResponse {\n  // add \"geoJson\" property to each response property that is an arcgis featureSet\n\n  // res.odLines only exists and only includes geometry in this condition (out of 3 possible options.params.outputType conditions)\n  if (\n    options.params.outputType === \"esriNAODOutputStraightLines\" &&\n    res.odLines &&\n    res.odLines.spatialReference.wkid === 4326\n  ) {\n    res.odLines.geoJson = arcgisToGeoJSON(res.odLines);\n  }\n\n  if (res.origins && res.origins.spatialReference.wkid === 4326) {\n    res.origins.geoJson = arcgisToGeoJSON(res.origins);\n  }\n\n  if (res.destinations && res.destinations.spatialReference.wkid === 4326) {\n    res.destinations.geoJson = arcgisToGeoJSON(res.destinations);\n  }\n\n  if (res.barriers && res.barriers.spatialReference.wkid === 4326) {\n    res.barriers.geoJson = arcgisToGeoJSON(res.barriers);\n  }\n\n  if (\n    res.polygonBarriers &&\n    res.polygonBarriers.spatialReference.wkid === 4326\n  ) {\n    res.polygonBarriers.geoJson = arcgisToGeoJSON(res.polygonBarriers);\n  }\n\n  if (\n    res.polylineBarriers &&\n    res.polylineBarriers.spatialReference.wkid === 4326\n  ) {\n    res.polylineBarriers.geoJson = arcgisToGeoJSON(res.polylineBarriers);\n  }\n\n  return res;\n}\n\nexport default {\n  originDestinationMatrix\n};\n"],"names":["isLocationArray","isLocation","cleanResponse","getTravelDirection"],"mappings":";;;;;;;AAAA;;AAYA;MACa,yBAAyB,GACpC,iFAAiF;MACtE,kCAAkC,GAC7C,qGAAqG;MAC1F,8BAA8B,GACzC,8FAA8F;MACnF,2CAA2C,GACtD,6HAA6H;AAU/H,SAASA,iBAAe,CACtB,MAAwE;IAExE,QACG,MAA2B,CAAC,MAAM,KAAK,CAAC;QACxC,MAAmC,CAAC,MAAM,KAAK,CAAC,EACjD;AACJ,CAAC;AAED,SAASC,YAAU,CACjB,MAAwE;IAExE,QACG,MAAoB,CAAC,QAAQ,KAAK,SAAS;QAC3C,MAAoB,CAAC,GAAG,KAAK,SAAS,EACvC;AACJ,CAAC;SAEe,sBAAsB,CACpC,SAAuD;IAEvD,OAAO,SAAS,CAAC,GAAG,CAAC,CAAC,MAAM;QAC1B,IAAID,iBAAe,CAAC,MAAM,CAAC,EAAE;YAC3B,OAAO,MAAM,CAAC,IAAI,EAAE,CAAC;SACtB;aAAM,IAAIC,YAAU,CAAC,MAAM,CAAC,EAAE;YAC7B,IAAI,MAAM,CAAC,GAAG,EAAE;gBACd,OAAO,MAAM,CAAC,IAAI,GAAG,GAAG,GAAG,MAAM,CAAC,GAAG,CAAC;aACvC;iBAAM;gBACL,OAAO,MAAM,CAAC,SAAS,GAAG,GAAG,GAAG,MAAM,CAAC,QAAQ,CAAC;aACjD;SACF;aAAM;YACL,OAAO,MAAM,CAAC,CAAC,GAAG,GAAG,GAAG,MAAM,CAAC,CAAC,CAAC;SAClC;KACF,CAAC,CAAC;AACL,CAAC;SAEe,kBAAkB,CAAC,GAAW;IAC5C,IAAI,SAAS,GAAG,CAAC,CAAC;IAClB,IAAI,SAAS,GAAG,CAAC,CAAC;IAClB,MAAM,MAAM,GAAG,EAAE,CAAC;IAClB,IAAI,CAAC,CAAC;IACN,IAAI,CAAC,CAAC;;IAGN,MAAM,OAAO,GAAG,GAAG,CAAC,KAAK,CAAC,iBAAiB,CAAC,CAAC;;IAG7C,MAAM,WAAW,GAAG,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;IAE7C,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,IAAI,CAAC,EAAE;;;QAG1C,CAAC,GAAG,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,GAAG,SAAS,CAAC;QACzC,SAAS,GAAG,CAAC,CAAC;;;QAId,CAAC,GAAG,QAAQ,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,CAAC,GAAG,SAAS,CAAC;QAC7C,SAAS,GAAG,CAAC,CAAC;QAEd,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,WAAW,EAAE,CAAC,GAAG,WAAW,CAAe,CAAC,CAAC;KAC/D;IAED,OAAO;QACL,KAAK,EAAE,CAAC,MAAM,CAAC;KACH,CAAC;AACjB,CAAC;AAED;;;SAGgB,YAAY,CAAC,GAAQ;IACnC,OAAO,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,GAAG,EAAE,UAAU,CAAC,CAAC;AAC/D,CAAC;AAED;;;SAGgB,aAAa,CAAC,GAAQ;IACpC,OAAO,KAAK,IAAI,GAAG,CAAC;AACtB;;AC9GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,kBAAkB,GAAG,SAAS,kBAAkB,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE;AACrE,EAAE,IAAI,GAAG,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;AAClF,EAAE,IAAI,GAAG,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;AAClF,EAAE,IAAI,EAAE,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;AACjF;AACA,EAAE,IAAI,EAAE,KAAK,CAAC,EAAE;AAChB,IAAI,IAAI,EAAE,GAAG,GAAG,GAAG,EAAE,CAAC;AACtB,IAAI,IAAI,EAAE,GAAG,GAAG,GAAG,EAAE,CAAC;AACtB;AACA,IAAI,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,EAAE;AAClD,MAAM,OAAO,IAAI,CAAC;AAClB,KAAK;AACL,GAAG;AACH;AACA,EAAE,OAAO,KAAK,CAAC;AACf,CAAC,CAAC;AACF,IAAI,uBAAuB,GAAG,SAAS,uBAAuB,CAAC,WAAW,EAAE,KAAK,EAAE;AACnF,EAAE,IAAI,QAAQ,GAAG,KAAK,CAAC;AACvB;AACA,EAAE,KAAK,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,WAAW,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE;AACtE,IAAI,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,CAAC,CAAC,GAAG,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,CAAC,CAAC,GAAG,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,KAAK,CAAC,CAAC,CAAC,GAAG,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;AAC/R,MAAM,QAAQ,GAAG,CAAC,QAAQ,CAAC;AAC3B,KAAK;AACL,GAAG;AACH;AACA,EAAE,OAAO,QAAQ,CAAC;AAClB,CAAC,CAAC;AACF,IAAI,WAAW,GAAG,SAAS,WAAW,CAAC,CAAC,EAAE,CAAC,EAAE;AAC7C,EAAE,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AACrC,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,EAAE;AACvB,MAAM,OAAO,KAAK,CAAC;AACnB,KAAK;AACL,GAAG;AACH;AACA,EAAE,OAAO,IAAI,CAAC;AACd,CAAC,CAAC;AACF,IAAI,oBAAoB,GAAG,SAAS,oBAAoB,CAAC,CAAC,EAAE,CAAC,EAAE;AAC/D,EAAE,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE;AACzC,IAAI,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE;AAC3C,MAAM,IAAI,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE;AAC9D,QAAQ,OAAO,IAAI,CAAC;AACpB,OAAO;AACP,KAAK;AACL,GAAG;AACH;AACA,EAAE,OAAO,KAAK,CAAC;AACf,CAAC,CAAC;AACF;AACA;AACA;AACA;AACA,IAAI,SAAS,GAAG,SAAS,SAAS,CAAC,WAAW,EAAE;AAChD,EAAE,IAAI,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC,CAAC,EAAE,WAAW,CAAC,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,EAAE;AACzE,IAAI,WAAW,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC;AACrC,GAAG;AACH;AACA,EAAE,OAAO,WAAW,CAAC;AACrB,CAAC,CAAC;AACF;AACA;AACA;AACA,IAAI,eAAe,GAAG,SAAS,eAAe,CAAC,UAAU,EAAE;AAC3D,EAAE,IAAI,KAAK,GAAG,CAAC,CAAC;AAChB,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC;AACZ,EAAE,IAAI,OAAO,GAAG,UAAU,CAAC,MAAM,CAAC;AAClC,EAAE,IAAI,GAAG,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC;AAC1B,EAAE,IAAI,GAAG,CAAC;AACV;AACA,EAAE,KAAK,CAAC,EAAE,CAAC,GAAG,OAAO,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE;AAChC,IAAI,GAAG,GAAG,UAAU,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;AAC5B,IAAI,KAAK,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;AACnD,IAAI,GAAG,GAAG,GAAG,CAAC;AACd,GAAG;AACH;AACA,EAAE,OAAO,KAAK,IAAI,CAAC,CAAC;AACpB,CAAC,CAAC;AACF;AACA;AACA,IAAI,YAAY,GAAG,SAAS,YAAY,CAAC,GAAG,EAAE;AAC9C,EAAE,IAAI,MAAM,GAAG,EAAE,CAAC;AAClB;AACA,EAAE,KAAK,IAAI,CAAC,IAAI,GAAG,EAAE;AACrB;AACA,IAAI,IAAI,GAAG,CAAC,cAAc,CAAC,CAAC,CAAC,EAAE;AAC/B;AACA,MAAM,MAAM,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC;AACzB,KAAK;AACL,GAAG;AACH;AACA,EAAE,OAAO,MAAM,CAAC;AAChB,CAAC,CAAC;AACF;AACA;AACA;AACA;AACA,IAAI,6BAA6B,GAAG,SAAS,6BAA6B,CAAC,KAAK,EAAE,KAAK,EAAE;AACzF,EAAE,IAAI,UAAU,GAAG,oBAAoB,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;AACtD,EAAE,IAAI,QAAQ,GAAG,uBAAuB,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;AAC1D;AACA,EAAE,IAAI,CAAC,UAAU,IAAI,QAAQ,EAAE;AAC/B,IAAI,OAAO,IAAI,CAAC;AAChB,GAAG;AACH;AACA,EAAE,OAAO,KAAK,CAAC;AACf,CAAC,CAAC;AACF;AACA;AACA;AACA,IAAI,qBAAqB,GAAG,SAAS,qBAAqB,CAAC,KAAK,EAAE;AAClE,EAAE,IAAI,UAAU,GAAG,EAAE,CAAC;AACtB,EAAE,IAAI,KAAK,GAAG,EAAE,CAAC;AACjB,EAAE,IAAI,CAAC,CAAC;AACR;AACA,EAAE,IAAI,SAAS,CAAC;AAChB;AACA,EAAE,IAAI,IAAI,CAAC;AACX;AACA;AACA,EAAE,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AACzC,IAAI,IAAI,IAAI,GAAG,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;AAC5C;AACA,IAAI,IAAI,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE;AACzB,MAAM,SAAS;AACf,KAAK;AACL;AACA;AACA,IAAI,IAAI,eAAe,CAAC,IAAI,CAAC,EAAE;AAC/B,MAAM,IAAI,OAAO,GAAG,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC,OAAO,EAAE,CAAC,CAAC;AAC7C;AACA,MAAM,UAAU,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AAC/B,KAAK,MAAM;AACX,MAAM,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC,OAAO,EAAE,CAAC,CAAC;AACzC,KAAK;AACL,GAAG;AACH;AACA,EAAE,IAAI,gBAAgB,GAAG,EAAE,CAAC;AAC5B;AACA,EAAE,OAAO,KAAK,CAAC,MAAM,EAAE;AACvB;AACA,IAAI,IAAI,GAAG,KAAK,CAAC,GAAG,EAAE,CAAC;AACvB;AACA,IAAI,IAAI,SAAS,GAAG,KAAK,CAAC;AAC1B;AACA,IAAI,KAAK,CAAC,GAAG,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;AACjD,MAAM,SAAS,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AACnC;AACA,MAAM,IAAI,6BAA6B,CAAC,SAAS,EAAE,IAAI,CAAC,EAAE;AAC1D;AACA,QAAQ,UAAU,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AACjC,QAAQ,SAAS,GAAG,IAAI,CAAC;AACzB,QAAQ,MAAM;AACd,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA,IAAI,IAAI,CAAC,SAAS,EAAE;AACpB,MAAM,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AAClC,KAAK;AACL,GAAG;AACH;AACA;AACA,EAAE,OAAO,gBAAgB,CAAC,MAAM,EAAE;AAClC;AACA,IAAI,IAAI,GAAG,gBAAgB,CAAC,GAAG,EAAE,CAAC;AAClC;AACA,IAAI,IAAI,UAAU,GAAG,KAAK,CAAC;AAC3B;AACA,IAAI,KAAK,CAAC,GAAG,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;AACjD,MAAM,SAAS,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AACnC;AACA,MAAM,IAAI,oBAAoB,CAAC,SAAS,EAAE,IAAI,CAAC,EAAE;AACjD;AACA,QAAQ,UAAU,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AACjC,QAAQ,UAAU,GAAG,IAAI,CAAC;AAC1B,QAAQ,MAAM;AACd,OAAO;AACP,KAAK;AACL;AACA,IAAI,IAAI,CAAC,UAAU,EAAE;AACrB,MAAM,UAAU,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;AACxC,KAAK;AACL,GAAG;AACH;AACA,EAAE,IAAI,UAAU,CAAC,MAAM,KAAK,CAAC,EAAE;AAC/B,IAAI,OAAO;AACX,MAAM,IAAI,EAAE,SAAS;AACrB,MAAM,WAAW,EAAE,UAAU,CAAC,CAAC,CAAC;AAChC,KAAK,CAAC;AACN,GAAG,MAAM;AACT,IAAI,OAAO;AACX,MAAM,IAAI,EAAE,cAAc;AAC1B,MAAM,WAAW,EAAE,UAAU;AAC7B,KAAK,CAAC;AACN,GAAG;AACH,CAAC,CAAC;AACF;AACA,IAAI,KAAK,GAAG,SAAS,KAAK,CAAC,UAAU,EAAE,WAAW,EAAE;AACpD,EAAE,IAAI,IAAI,GAAG,WAAW,GAAG,CAAC,WAAW,EAAE,UAAU,EAAE,KAAK,CAAC,GAAG,CAAC,UAAU,EAAE,KAAK,CAAC,CAAC;AAClF;AACA,EAAE,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AACxC,IAAI,IAAI,GAAG,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;AACtB;AACA,IAAI,IAAI,GAAG,IAAI,UAAU,KAAK,OAAO,UAAU,CAAC,GAAG,CAAC,KAAK,QAAQ,IAAI,OAAO,UAAU,CAAC,GAAG,CAAC,KAAK,QAAQ,CAAC,EAAE;AAC3G,MAAM,OAAO,UAAU,CAAC,GAAG,CAAC,CAAC;AAC7B,KAAK;AACL,GAAG;AACH;AACA,EAAE,MAAM,KAAK,CAAC,6BAA6B,CAAC,CAAC;AAC7C,CAAC,CAAC;AACF;AACA,IAAI,eAAe,GAAG,SAAS,eAAe,CAAC,MAAM,EAAE,WAAW,EAAE;AACpE,EAAE,IAAI,OAAO,GAAG,EAAE,CAAC;AACnB;AACA,EAAE,IAAI,MAAM,CAAC,QAAQ,EAAE;AACvB,IAAI,OAAO,CAAC,IAAI,GAAG,mBAAmB,CAAC;AACvC,IAAI,OAAO,CAAC,QAAQ,GAAG,EAAE,CAAC;AAC1B;AACA,IAAI,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AACrD,MAAM,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,WAAW,CAAC,CAAC,CAAC;AAC9E,KAAK;AACL,GAAG;AACH;AACA,EAAE,IAAI,OAAO,MAAM,CAAC,CAAC,KAAK,QAAQ,IAAI,OAAO,MAAM,CAAC,CAAC,KAAK,QAAQ,EAAE;AACpE,IAAI,OAAO,CAAC,IAAI,GAAG,OAAO,CAAC;AAC3B,IAAI,OAAO,CAAC,WAAW,GAAG,CAAC,MAAM,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC;AAC/C;AACA,IAAI,IAAI,OAAO,MAAM,CAAC,CAAC,KAAK,QAAQ,EAAE;AACtC,MAAM,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;AACzC,KAAK;AACL,GAAG;AACH;AACA,EAAE,IAAI,MAAM,CAAC,MAAM,EAAE;AACrB,IAAI,OAAO,CAAC,IAAI,GAAG,YAAY,CAAC;AAChC,IAAI,OAAO,CAAC,WAAW,GAAG,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;AACjD,GAAG;AACH;AACA,EAAE,IAAI,MAAM,CAAC,KAAK,EAAE;AACpB,IAAI,IAAI,MAAM,CAAC,KAAK,CAAC,MAAM,KAAK,CAAC,EAAE;AACnC,MAAM,OAAO,CAAC,IAAI,GAAG,YAAY,CAAC;AAClC,MAAM,OAAO,CAAC,WAAW,GAAG,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;AACrD,KAAK,MAAM;AACX,MAAM,OAAO,CAAC,IAAI,GAAG,iBAAiB,CAAC;AACvC,MAAM,OAAO,CAAC,WAAW,GAAG,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;AAClD,KAAK;AACL,GAAG;AACH;AACA,EAAE,IAAI,MAAM,CAAC,KAAK,EAAE;AACpB,IAAI,OAAO,GAAG,qBAAqB,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;AAC3D,GAAG;AACH;AACA,EAAE,IAAI,OAAO,MAAM,CAAC,IAAI,KAAK,QAAQ,IAAI,OAAO,MAAM,CAAC,IAAI,KAAK,QAAQ,IAAI,OAAO,MAAM,CAAC,IAAI,KAAK,QAAQ,IAAI,OAAO,MAAM,CAAC,IAAI,KAAK,QAAQ,EAAE;AAChJ,IAAI,OAAO,CAAC,IAAI,GAAG,SAAS,CAAC;AAC7B,IAAI,OAAO,CAAC,WAAW,GAAG,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,EAAE,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,IAAI,EAAE,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,IAAI,EAAE,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,IAAI,EAAE,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,IAAI,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;AACzK,GAAG;AACH;AACA,EAAE,IAAI,MAAM,CAAC,QAAQ,IAAI,MAAM,CAAC,UAAU,EAAE;AAC5C,IAAI,OAAO,CAAC,IAAI,GAAG,SAAS,CAAC;AAC7B,IAAI,OAAO,CAAC,QAAQ,GAAG,MAAM,CAAC,QAAQ,GAAG,eAAe,CAAC,MAAM,CAAC,QAAQ,CAAC,GAAG,IAAI,CAAC;AACjF,IAAI,OAAO,CAAC,UAAU,GAAG,MAAM,CAAC,UAAU,GAAG,YAAY,CAAC,MAAM,CAAC,UAAU,CAAC,GAAG,IAAI,CAAC;AACpF;AACA,IAAI,IAAI,MAAM,CAAC,UAAU,EAAE;AAC3B,MAAM,IAAI;AACV,QAAQ,OAAO,CAAC,EAAE,GAAG,KAAK,CAAC,MAAM,CAAC,UAAU,EAAE,WAAW,CAAC,CAAC;AAC3D,OAAO,CAAC,OAAO,GAAG,EAAE;AACpB,OAAO;AACP,KAAK;AACL,GAAG;AACH;AACA;AACA,EAAE,IAAI,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,QAAQ,CAAC,KAAK,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,EAAE;AAC/D,IAAI,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC;AAC5B,GAAG;AACH;AACA,EAAE,IAAI,MAAM,CAAC,gBAAgB,IAAI,MAAM,CAAC,gBAAgB,CAAC,IAAI,IAAI,MAAM,CAAC,gBAAgB,CAAC,IAAI,KAAK,IAAI,EAAE;AACxG,IAAI,OAAO,CAAC,IAAI,CAAC,yCAAyC,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,gBAAgB,CAAC,CAAC,CAAC;AACtG,GAAG;AACH;AACA,EAAE,OAAO,OAAO,CAAC;AACjB,CAAC;;AC/RD;;AAkDA,SAAS,eAAe,CACtB,MAAwE;IAExE,QACG,MAA2B,CAAC,MAAM,KAAK,CAAC;QACxC,MAAmC,CAAC,MAAM,KAAK,CAAC,EACjD;AACJ,CAAC;AAED,SAAS,UAAU,CACjB,MAAwE;IAExE,QACG,MAAoB,CAAC,QAAQ,KAAK,SAAS;QAC3C,MAAoB,CAAC,GAAG,KAAK,SAAS,EACvC;AACJ,CAAC;AAED;;;;;;;;;;;;;;;;;;;;SAoBgB,UAAU,CACxB,cAAkC;IAElC,MAAM,OAAO,mBACX,QAAQ,EAAE,cAAc,CAAC,QAAQ,IAAI,yBAAyB,EAC9D,MAAM,EAAE,EAAE,IACP,cAAc,CAClB,CAAC;;IAGF,IACE,CAAC,cAAc,CAAC,cAAc;QAC9B,OAAO,CAAC,QAAQ,KAAK,yBAAyB,EAC9C;QACA,OAAO,OAAO,CAAC,MAAM,CACnB,0DAA0D,CAC3D,CAAC;KACH;IAED,IAAI,YAAY,CAAC,cAAc,CAAC,KAAK,CAAC,EAAE;QACtC,OAAO,CAAC,MAAM,CAAC,KAAK,GAAG,cAAc,CAAC,KAAK,CAAC;KAC7C;SAAM;QACL,MAAM,KAAK,GAAa,cAAc,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,MAAM;YACtD,IAAI,eAAe,CAAC,MAAM,CAAC,EAAE;gBAC3B,OAAO,MAAM,CAAC,IAAI,EAAE,CAAC;aACtB;iBAAM,IAAI,UAAU,CAAC,MAAM,CAAC,EAAE;gBAC7B,IAAI,MAAM,CAAC,GAAG,EAAE;oBACd,QACE,MAAM,CAAC,IAAI,GAAG,GAAG,GAAG,MAAM,CAAC,GAAG,IAAI,MAAM,CAAC,CAAC,GAAG,GAAG,GAAG,MAAM,CAAC,CAAC,GAAG,EAAE,CAAC,EACjE;iBACH;qBAAM;oBACL,QACE,MAAM,CAAC,SAAS;wBAChB,GAAG;wBACH,MAAM,CAAC,QAAQ;yBACd,MAAM,CAAC,CAAC,GAAG,GAAG,GAAG,MAAM,CAAC,CAAC,GAAG,EAAE,CAAC,EAChC;iBACH;aACF;iBAAM;gBACL,OAAO,MAAM,CAAC,CAAC,GAAG,GAAG,GAAG,MAAM,CAAC,CAAC,IAAI,MAAM,CAAC,CAAC,GAAG,GAAG,GAAG,MAAM,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;aACrE;SACF,CAAC,CAAC;QAEH,OAAO,CAAC,MAAM,CAAC,KAAK,GAAG,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;KACxC;IAED,OAAO,OAAO,CAAC,GAAG,QAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC,IAAI,CACjEC,eAAa,CACd,CAAC;AACJ,CAAC;AAED,SAASA,eAAa,CAAC,GAAQ;IAC7B,IAAI,GAAG,CAAC,UAAU,IAAI,GAAG,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE;QAC/C,GAAG,CAAC,UAAU,GAAG,GAAG,CAAC,UAAU,CAAC,GAAG,CACjC,CAAC,SAKA;YACC,SAAS,CAAC,QAAQ,GAAG,SAAS,CAAC,QAAQ,CAAC,GAAG,CACzC,CAAC,OAAuC;gBACtC,OAAO,CAAC,QAAQ,GAAG,kBAAkB,CAAC,OAAO,CAAC,kBAAkB,CAAC,CAAC;gBAClE,OAAO,OAAO,CAAC;aAChB,CACF,CAAC;YACF,OAAO,SAAS,CAAC;SAClB,CACF,CAAC;KACH;;IAGD,IAAI,GAAG,CAAC,MAAM,CAAC,gBAAgB,CAAC,IAAI,KAAK,IAAI,EAAE;QAC7C,MAAM,QAAQ,GAAG,GAAG,CAAC,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,OAAY;YACpD,OAAO;gBACL,IAAI,EAAE,SAAS;gBACf,QAAQ,EAAE,eAAe,CAAC,OAAO,CAAC,QAAQ,CAAC;gBAC3C,UAAU,EAAE,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,OAAO,CAAC,UAAU,CAAC;aAClD,CAAC;SACH,CAAC,CAAC;QAEH,GAAG,CAAC,MAAM,CAAC,OAAO,GAAG;YACnB,IAAI,EAAE,mBAAmB;YACzB,QAAQ;SACT,CAAC;KACH;IACD,OAAO,GAAG,CAAC;AACb;;AC/KA;;AAiGA,SAASC,oBAAkB,CACzB,GAAsD;IAEtD,IAAI,GAAG,KAAK,uBAAuB,EAAE;QACnC,OAAO,mCAAmC,CAAC;KAC5C;SAAM;QACL,OAAO,iCAAiC,CAAC;KAC1C;AACH,CAAC;AAED;;;;;;;;;;;;;;;;;;;;;;;;;;SA0BgB,eAAe,CAC7B,cAAuC;IAEvC,MAAM,QAAQ,GACZ,cAAc,CAAC,QAAQ,IAAI,kCAAkC,CAAC;IAEhE,cAAc,CAAC,MAAM,mBACnB,gBAAgB,EAAE,IAAI,EACtB,gBAAgB,EAAE,IAAI,EACtB,eAAe,EAAE,IAAI,EACrB,cAAc,EAAE,IAAI,EACpB,sBAAsB,EAAE,IAAI,EAC5B,qBAAqB,EAAE,IAAI,EAC3B,gBAAgB,EAAE,IAAI,IACnB,cAAc,CAAC,MAAM,CACzB,CAAC;IAEF,MAAM,OAAO,GAAG,kBAAkB,CAA0B,cAAc,EAAE;QAC1E,gBAAgB;;QAEhB,UAAU;QACV,kBAAkB;QAClB,iBAAiB;QACjB,kBAAkB;QAClB,sBAAsB;QACtB,uBAAuB;QACvB,aAAa;QACb,kBAAkB;QAClB,iBAAiB;QACjB,gBAAgB;QAChB,wBAAwB;QACxB,uBAAuB;QACvB,kBAAkB;KACnB,CAAC,CAAC;;IAGH,IAAI,cAAc,CAAC,eAAe,EAAE;QAClC,OAAO,CAAC,MAAM,CAAC,eAAe,GAAGA,oBAAkB,CACjD,cAAc,CAAC,eAAe,CAC/B,CAAC;KACH;;IAGD,IACE,CAAC,cAAc,CAAC,cAAc;QAC9B,QAAQ,KAAK,kCAAkC,EAC/C;QACA,OAAO,OAAO,CAAC,MAAM,CACnB,+EAA+E,CAChF,CAAC;KACH;IAED,IACE,YAAY,CAAC,cAAc,CAAC,SAAS,CAAC;QACtC,aAAa,CAAC,cAAc,CAAC,SAAS,CAAC,EACvC;QACA,OAAO,CAAC,MAAM,CAAC,SAAS,GAAG,cAAc,CAAC,SAAS,CAAC;KACrD;SAAM;QACL,OAAO,CAAC,MAAM,CAAC,SAAS,GAAG,sBAAsB,CAC/C,cAAc,CAAC,SAAS,CACzB,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;KACb;IAED,IACE,YAAY,CAAC,cAAc,CAAC,UAAU,CAAC;QACvC,aAAa,CAAC,cAAc,CAAC,UAAU,CAAC,EACxC;QACA,OAAO,CAAC,MAAM,CAAC,UAAU,GAAG,cAAc,CAAC,UAAU,CAAC;KACvD;SAAM;QACL,OAAO,CAAC,MAAM,CAAC,UAAU,GAAG,sBAAsB,CAChD,cAAc,CAAC,UAAU,CAC1B,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;KACb;;IAGD,IAAI,cAAc,CAAC,QAAQ,EAAE;QAC3B,IAAI,YAAY,CAAC,cAAc,CAAC,QAAQ,CAAC,EAAE;YACzC,OAAO,CAAC,MAAM,CAAC,QAAQ,GAAG,cAAc,CAAC,QAAQ,CAAC;SACnD;aAAM;;;;YAIL,OAAO,CAAC,MAAM,CAAC,QAAQ,GAAG,sBAAsB,CAC9C,cAAc,CAAC,QAAQ,CACxB,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;SACb;KACF;IAED,OAAO,OAAO,CAAC,GAAG,QAAQ,CAAC,QAAQ,CAAC,uBAAuB,EAAE,OAAO,CAAC,CAAC,IAAI,CACxED,eAAa,CACd,CAAC;AACJ,CAAC;AAED,SAASA,eAAa,CAAC,GAAQ;;IAE7B,IAAI,GAAG,CAAC,MAAM,CAAC,gBAAgB,CAAC,IAAI,KAAK,IAAI,EAAE;QAC7C,GAAG,CAAC,MAAM,CAAC,OAAO,GAAG,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;KAClD;IACD,OAAO,GAAG,CAAC;AACb;;ACxOA;;AAuDA,SAAS,kBAAkB,CACzB,GAAsD;IAEtD,IAAI,GAAG,KAAK,uBAAuB,EAAE;QACnC,OAAO,mCAAmC,CAAC;KAC5C;SAAM;QACL,OAAO,iCAAiC,CAAC;KAC1C;AACH,CAAC;AAED;;;;;;;;;;;;;;;;;;;;;SAqBgB,WAAW,CACzB,cAAmC;IAEnC,MAAM,QAAQ,GAAG,cAAc,CAAC,QAAQ,IAAI,8BAA8B,CAAC;IAE3E,cAAc,CAAC,MAAM,mBACnB,gBAAgB,EAAE,IAAI,EACtB,cAAc,EAAE,IAAI,EACpB,sBAAsB,EAAE,IAAI,EAC5B,qBAAqB,EAAE,IAAI,EAC3B,gBAAgB,EAAE,IAAI,IACnB,cAAc,CAAC,MAAM,CACzB,CAAC;IAEF,MAAM,OAAO,GAAG,kBAAkB,CAAsB,cAAc,EAAE;QACtE,UAAU;QACV,kBAAkB;QAClB,iBAAiB;QACjB,aAAa;QACb,kBAAkB;QAClB,gBAAgB;QAChB,wBAAwB;QACxB,uBAAuB;QACvB,kBAAkB;KACnB,CAAC,CAAC;;IAGH,IAAI,cAAc,CAAC,eAAe,EAAE;QAClC,OAAO,CAAC,MAAM,CAAC,eAAe,GAAG,kBAAkB,CACjD,cAAc,CAAC,eAAe,CAC/B,CAAC;KACH;;IAGD,IACE,CAAC,cAAc,CAAC,cAAc;QAC9B,QAAQ,KAAK,8BAA8B,EAC3C;QACA,OAAO,OAAO,CAAC,MAAM,CACnB,wEAAwE,CACzE,CAAC;KACH;IAED,IAAI,YAAY,CAAC,cAAc,CAAC,UAAU,CAAC,EAAE;QAC3C,OAAO,CAAC,MAAM,CAAC,UAAU,GAAG,cAAc,CAAC,UAAU,CAAC;KACvD;SAAM;QACL,OAAO,CAAC,MAAM,CAAC,UAAU,GAAG,sBAAsB,CAChD,cAAc,CAAC,UAAU,CAC1B,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;KACb;;IAGD,IAAI,cAAc,CAAC,QAAQ,EAAE;QAC3B,IAAI,YAAY,CAAC,cAAc,CAAC,QAAQ,CAAC,EAAE;YACzC,OAAO,CAAC,MAAM,CAAC,QAAQ,GAAG,cAAc,CAAC,QAAQ,CAAC;SACnD;aAAM;;;;YAIL,OAAO,CAAC,MAAM,CAAC,QAAQ,GAAG,sBAAsB,CAC9C,cAAc,CAAC,QAAQ,CACxB,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;SACb;KACF;IAED,OAAO,OAAO,CAAC,GAAG,QAAQ,CAAC,QAAQ,CAAC,mBAAmB,EAAE,OAAO,CAAC,CAAC,IAAI,CACpEA,eAAa,CACd,CAAC;AACJ,CAAC;AAED,SAASA,eAAa,CAAC,GAAQ;;IAE7B,OAAO,GAAG,CAAC,UAAU,CAAC,YAAY,CAAC;;IAGnC,IAAI,GAAG,CAAC,UAAU,CAAC,gBAAgB,CAAC,IAAI,KAAK,IAAI,EAAE;QACjD,GAAG,CAAC,UAAU,CAAC,OAAO,GAAG,eAAe,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;KAC1D;IACD,OAAO,GAAG,CAAC;AACb;;ACrKA;;AAqEA;;;;;;;;;;;;;;;;;;;;;;;;;SAyBgB,uBAAuB,CACrC,cAA+C;IAE/C,MAAM,QAAQ,GACZ,cAAc,CAAC,QAAQ,IAAI,2CAA2C,CAAC;IAEzE,cAAc,CAAC,MAAM,mBACnB,UAAU,EAAE,4BAA4B,EACxC,aAAa,EAAE,IAAI,EACnB,kBAAkB,EAAE,IAAI,EACxB,cAAc,EAAE,IAAI,EACpB,sBAAsB,EAAE,IAAI,EAC5B,qBAAqB,EAAE,IAAI,IACxB,cAAc,CAAC,MAAM,CACzB,CAAC;IAEF,MAAM,OAAO,GAAG,kBAAkB,CAChC,cAAc,EACd;QACE,YAAY;QACZ,UAAU;QACV,kBAAkB;QAClB,iBAAiB;QACjB,eAAe;QACf,oBAAoB;QACpB,gBAAgB;QAChB,wBAAwB;QACxB,uBAAuB;KACxB,CACF,CAAC;;IAGF,IACE,CAAC,cAAc,CAAC,cAAc;QAC9B,QAAQ,KAAK,2CAA2C,EACxD;QACA,OAAO,OAAO,CAAC,MAAM,CACnB,iGAAiG,CAClG,CAAC;KACH;;IAGD,IAAI,YAAY,CAAC,cAAc,CAAC,OAAO,CAAC,EAAE;QACxC,OAAO,CAAC,MAAM,CAAC,OAAO,GAAG,cAAc,CAAC,OAAO,CAAC;KACjD;SAAM;QACL,OAAO,CAAC,MAAM,CAAC,OAAO,GAAG,sBAAsB,CAC7C,cAAc,CAAC,OAAO,CACvB,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;KACb;IAED,IAAI,YAAY,CAAC,cAAc,CAAC,YAAY,CAAC,EAAE;QAC7C,OAAO,CAAC,MAAM,CAAC,YAAY,GAAG,cAAc,CAAC,YAAY,CAAC;KAC3D;SAAM;QACL,OAAO,CAAC,MAAM,CAAC,YAAY,GAAG,sBAAsB,CAClD,cAAc,CAAC,YAAY,CAC5B,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;KACb;;IAGD,IAAI,cAAc,CAAC,QAAQ,EAAE;QAC3B,IAAI,YAAY,CAAC,cAAc,CAAC,QAAQ,CAAC,EAAE;YACzC,OAAO,CAAC,MAAM,CAAC,QAAQ,GAAG,cAAc,CAAC,QAAQ,CAAC;SACnD;aAAM;;;;YAIL,OAAO,CAAC,MAAM,CAAC,QAAQ,GAAG,sBAAsB,CAC9C,cAAc,CAAC,QAAQ,CACxB,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;SACb;KACF;IAED,OAAO,OAAO,CAAC,GAAG,QAAQ,CAAC,QAAQ,CAAC,oBAAoB,EAAE,OAAO,CAAC,CAAC,IAAI,CACrE,UAAU,GAAG;QACX,OAAO,aAAa,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC;KACpC,CACF,CAAC;AACJ,CAAC;AAED,SAAS,aAAa,CACpB,GAAQ,EACR,OAAwB;;;IAKxB,IACE,OAAO,CAAC,MAAM,CAAC,UAAU,KAAK,6BAA6B;QAC3D,GAAG,CAAC,OAAO;QACX,GAAG,CAAC,OAAO,CAAC,gBAAgB,CAAC,IAAI,KAAK,IAAI,EAC1C;QACA,GAAG,CAAC,OAAO,CAAC,OAAO,GAAG,eAAe,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;KACpD;IAED,IAAI,GAAG,CAAC,OAAO,IAAI,GAAG,CAAC,OAAO,CAAC,gBAAgB,CAAC,IAAI,KAAK,IAAI,EAAE;QAC7D,GAAG,CAAC,OAAO,CAAC,OAAO,GAAG,eAAe,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;KACpD;IAED,IAAI,GAAG,CAAC,YAAY,IAAI,GAAG,CAAC,YAAY,CAAC,gBAAgB,CAAC,IAAI,KAAK,IAAI,EAAE;QACvE,GAAG,CAAC,YAAY,CAAC,OAAO,GAAG,eAAe,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;KAC9D;IAED,IAAI,GAAG,CAAC,QAAQ,IAAI,GAAG,CAAC,QAAQ,CAAC,gBAAgB,CAAC,IAAI,KAAK,IAAI,EAAE;QAC/D,GAAG,CAAC,QAAQ,CAAC,OAAO,GAAG,eAAe,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;KACtD;IAED,IACE,GAAG,CAAC,eAAe;QACnB,GAAG,CAAC,eAAe,CAAC,gBAAgB,CAAC,IAAI,KAAK,IAAI,EAClD;QACA,GAAG,CAAC,eAAe,CAAC,OAAO,GAAG,eAAe,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;KACpE;IAED,IACE,GAAG,CAAC,gBAAgB;QACpB,GAAG,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,IAAI,KAAK,IAAI,EACnD;QACA,GAAG,CAAC,gBAAgB,CAAC,OAAO,GAAG,eAAe,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC;KACtE;IAED,OAAO,GAAG,CAAC;AACb;;;;"}