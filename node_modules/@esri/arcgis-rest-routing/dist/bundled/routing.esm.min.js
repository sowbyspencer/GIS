/* @preserve
* @esri/arcgis-rest-routing - v4.0.2 - Apache-2.0
* Copyright (c) 2017-2022 Esri, Inc.
* Wed Oct 19 2022 03:11:49 GMT+0000 (Coordinated Universal Time)
*/
import{request as r,cleanUrl as e,appendCustomParams as i}from"@esri/arcgis-rest-request";const t="https://route.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",n="https://route.arcgis.com/arcgis/rest/services/World/ClosestFacility/NAServer/ClosestFacility_World",s="https://route.arcgis.com/arcgis/rest/services/World/ServiceAreas/NAServer/ServiceArea_World",a="https://route.arcgis.com/arcgis/rest/services/World/OriginDestinationCostMatrix/NAServer/OriginDestinationCostMatrix_World";function o(r){return r.map((r=>function(r){return 2===r.length||3===r.length}(r)?r.join():function(r){return void 0!==r.latitude||void 0!==r.lat}(r)?r.lat?r.long+","+r.lat:r.longitude+","+r.latitude:r.x+","+r.y))}function u(r){let e=0,i=0;const t=[];let n,s;const a=r.match(/((\+|-)[^+-]+)/g),o=parseInt(a[0],32);for(let r=1;r<a.length;r+=2)n=parseInt(a[r],32)+e,e=n,s=parseInt(a[r+1],32)+i,i=s,t.push([n/o,s/o]);return{paths:[t]}}function c(r){return Object.prototype.hasOwnProperty.call(r,"features")}function l(r){return"url"in r}
/* @preserve
* @terraformer/arcgis - v2.0.7 - MIT
* Copyright (c) 2012-2021 Environmental Systems Research Institute, Inc.
* Thu Jul 22 2021 13:58:30 GMT-0700 (Pacific Daylight Time)
*/var p=function(r,e,i,t){var n=(t[0]-i[0])*(r[1]-i[1])-(t[1]-i[1])*(r[0]-i[0]),s=(e[0]-r[0])*(r[1]-i[1])-(e[1]-r[1])*(r[0]-i[0]),a=(t[1]-i[1])*(e[0]-r[0])-(t[0]-i[0])*(e[1]-r[1]);if(0!==a){var o=n/a,u=s/a;if(o>=0&&o<=1&&u>=0&&u<=1)return!0}return!1},g=function(r,e){for(var i=0;i<r.length-1;i++)for(var t=0;t<e.length-1;t++)if(p(r[i],r[i+1],e[t],e[t+1]))return!0;return!1},f=function(r){for(var e,i=0,t=0,n=r.length,s=r[t];t<n-1;t++)i+=((e=r[t+1])[0]-s[0])*(e[1]+s[1]),s=e;return i>=0},y=function(r,e){var i=g(r,e),t=function(r,e){for(var i=!1,t=-1,n=r.length,s=n-1;++t<n;s=t)(r[t][1]<=e[1]&&e[1]<r[s][1]||r[s][1]<=e[1]&&e[1]<r[t][1])&&e[0]<(r[s][0]-r[t][0])*(e[1]-r[t][1])/(r[s][1]-r[t][1])+r[t][0]&&(i=!i);return i}(r,e[0]);return!(i||!t)},d=function r(e,i){var t={};if(e.features){t.type="FeatureCollection",t.features=[];for(var n=0;n<e.features.length;n++)t.features.push(r(e.features[n],i))}if("number"==typeof e.x&&"number"==typeof e.y&&(t.type="Point",t.coordinates=[e.x,e.y],"number"==typeof e.z&&t.coordinates.push(e.z)),e.points&&(t.type="MultiPoint",t.coordinates=e.points.slice(0)),e.paths&&(1===e.paths.length?(t.type="LineString",t.coordinates=e.paths[0].slice(0)):(t.type="MultiLineString",t.coordinates=e.paths.slice(0))),e.rings&&(t=function(r){for(var e,i,t,n,s=[],a=[],o=0;o<r.length;o++){var u=(function(r,e){for(var i=0;i<r.length;i++)if(r[i]!==e[i])return!1;return!0}((n=r[o].slice(0))[0],n[n.length-1])||n.push(n[0]),n);if(!(u.length<4))if(f(u)){var c=[u.slice().reverse()];s.push(c)}else a.push(u.slice().reverse())}for(var l=[];a.length;){t=a.pop();var p=!1;for(e=s.length-1;e>=0;e--)if(i=s[e][0],y(i,t)){s[e].push(t),p=!0;break}p||l.push(t)}for(;l.length;){t=l.pop();var d=!1;for(e=s.length-1;e>=0;e--)if(i=s[e][0],g(i,t)){s[e].push(t),d=!0;break}d||s.push([t.reverse()])}return 1===s.length?{type:"Polygon",coordinates:s[0]}:{type:"MultiPolygon",coordinates:s}}(e.rings.slice(0))),"number"==typeof e.xmin&&"number"==typeof e.ymin&&"number"==typeof e.xmax&&"number"==typeof e.ymax&&(t.type="Polygon",t.coordinates=[[[e.xmax,e.ymax],[e.xmin,e.ymax],[e.xmin,e.ymin],[e.xmax,e.ymin],[e.xmax,e.ymax]]]),(e.geometry||e.attributes)&&(t.type="Feature",t.geometry=e.geometry?r(e.geometry):null,t.properties=e.attributes?function(r){var e={};for(var i in r)r.hasOwnProperty(i)&&(e[i]=r[i]);return e}(e.attributes):null,e.attributes))try{t.id=function(r,e){for(var i=e?[e,"OBJECTID","FID"]:["OBJECTID","FID"],t=0;t<i.length;t++){var n=i[t];if(n in r&&("string"==typeof r[n]||"number"==typeof r[n]))return r[n]}throw Error("No valid id attribute found")}(e.attributes,i)}catch(r){}return JSON.stringify(t.geometry)===JSON.stringify({})&&(t.geometry=null),e.spatialReference&&e.spatialReference.wkid&&4326!==e.spatialReference.wkid&&console.warn("Object converted in non-standard crs - "+JSON.stringify(e.spatialReference)),t};function m(i){const n=Object.assign({endpoint:i.endpoint||t,params:{}},i);if(!i.authentication&&n.endpoint===t)return Promise.reject("Routing using the ArcGIS service requires authentication");if(c(i.stops))n.params.stops=i.stops;else{const r=i.stops.map((r=>function(r){return 2===r.length||3===r.length}(r)?r.join():function(r){return void 0!==r.latitude||void 0!==r.lat}(r)?r.lat?r.long+","+r.lat+(r.z?","+r.z:""):r.longitude+","+r.latitude+(r.z?","+r.z:""):r.x+","+r.y+(r.z?","+r.z:"")));n.params.stops=r.join(";")}return r(`${e(n.endpoint)}/solve`,n).then(h)}function h(r){if(r.directions&&r.directions.length>0&&(r.directions=r.directions.map((r=>(r.features=r.features.map((r=>(r.geometry=u(r.compressedGeometry),r))),r)))),4326===r.routes.spatialReference.wkid){const e=r.routes.features.map((r=>({type:"Feature",geometry:d(r.geometry),properties:Object.assign({},r.attributes)})));r.routes.geoJson={type:"FeatureCollection",features:e}}return r}function v(t){const s=t.endpoint||n;t.params=Object.assign({returnFacilities:!0,returnDirections:!0,returnIncidents:!0,returnBarriers:!0,returnPolylineBarriers:!0,returnPolygonBarriers:!0,preserveObjectID:!0},t.params);const a=i(t,["returnCFRoutes","barriers","polylineBarriers","polygonBarriers","returnDirections","directionsOutputType","directionsLengthUnits","outputLines","returnFacilities","returnIncidents","returnBarriers","returnPolylineBarriers","returnPolygonBarriers","preserveObjectID"]);return t.travelDirection&&(a.params.travelDirection="incidentsToFacilities"===t.travelDirection?"esriNATravelDirectionFromFacility":"esriNATravelDirectionToFacility"),t.authentication||s!==n?(c(t.incidents)||l(t.incidents)?a.params.incidents=t.incidents:a.params.incidents=o(t.incidents).join(";"),c(t.facilities)||l(t.facilities)?a.params.facilities=t.facilities:a.params.facilities=o(t.facilities).join(";"),t.barriers&&(c(t.barriers)?a.params.barriers=t.barriers:a.params.barriers=o(t.barriers).join(";")),r(`${e(s)}/solveClosestFacility`,a).then(b)):Promise.reject("Finding the closest facility using the ArcGIS service requires authentication")}function b(r){return 4326===r.routes.spatialReference.wkid&&(r.routes.geoJson=d(r.routes)),r}function B(t){const n=t.endpoint||s;t.params=Object.assign({returnFacilities:!0,returnBarriers:!0,returnPolylineBarriers:!0,returnPolygonBarriers:!0,preserveObjectID:!0},t.params);const a=i(t,["barriers","polylineBarriers","polygonBarriers","outputLines","returnFacilities","returnBarriers","returnPolylineBarriers","returnPolygonBarriers","preserveObjectID"]);return t.travelDirection&&(a.params.travelDirection="incidentsToFacilities"===t.travelDirection?"esriNATravelDirectionFromFacility":"esriNATravelDirectionToFacility"),t.authentication||n!==s?(c(t.facilities)?a.params.facilities=t.facilities:a.params.facilities=o(t.facilities).join(";"),t.barriers&&(c(t.barriers)?a.params.barriers=t.barriers:a.params.barriers=o(t.barriers).join(";")),r(`${e(n)}/solveServiceArea`,a).then(O)):Promise.reject("Finding service areas using the ArcGIS service requires authentication")}function O(r){return delete r.saPolygons.fieldAliases,4326===r.saPolygons.spatialReference.wkid&&(r.saPolygons.geoJson=d(r.saPolygons)),r}function D(t){const n=t.endpoint||a;t.params=Object.assign({outputType:"esriNAODOutputSparseMatrix",returnOrigins:!0,returnDestinations:!0,returnBarriers:!0,returnPolylineBarriers:!0,returnPolygonBarriers:!0},t.params);const s=i(t,["outputType","barriers","polylineBarriers","polygonBarriers","returnOrigins","returnDestinations","returnBarriers","returnPolylineBarriers","returnPolygonBarriers"]);return t.authentication||n!==a?(c(t.origins)?s.params.origins=t.origins:s.params.origins=o(t.origins).join(";"),c(t.destinations)?s.params.destinations=t.destinations:s.params.destinations=o(t.destinations).join(";"),t.barriers&&(c(t.barriers)?s.params.barriers=t.barriers:s.params.barriers=o(t.barriers).join(";")),r(`${e(n)}/solveODCostMatrix`,s).then((function(r){return function(r,e){"esriNAODOutputStraightLines"===e.params.outputType&&r.odLines&&4326===r.odLines.spatialReference.wkid&&(r.odLines.geoJson=d(r.odLines));r.origins&&4326===r.origins.spatialReference.wkid&&(r.origins.geoJson=d(r.origins));r.destinations&&4326===r.destinations.spatialReference.wkid&&(r.destinations.geoJson=d(r.destinations));r.barriers&&4326===r.barriers.spatialReference.wkid&&(r.barriers.geoJson=d(r.barriers));r.polygonBarriers&&4326===r.polygonBarriers.spatialReference.wkid&&(r.polygonBarriers.geoJson=d(r.polygonBarriers));r.polylineBarriers&&4326===r.polylineBarriers.spatialReference.wkid&&(r.polylineBarriers.geoJson=d(r.polylineBarriers));return r}(r,s)}))):Promise.reject("Calculating the origin-destination cost matrix using the ArcGIS service requires authentication")}export{n as ARCGIS_ONLINE_CLOSEST_FACILITY_URL,a as ARCGIS_ONLINE_ORIGIN_DESTINATION_MATRIX_URL,t as ARCGIS_ONLINE_ROUTING_URL,s as ARCGIS_ONLINE_SERVICE_AREA_URL,v as closestFacility,u as decompressGeometry,c as isFeatureSet,l as isJsonWithURL,o as normalizeLocationsList,D as originDestinationMatrix,B as serviceArea,m as solveRoute};
//# sourceMappingURL=routing.esm.min.js.map
